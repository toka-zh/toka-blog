---
title: "BTC协议"
date: 2022-05-20
tags: ["BlockChain"]
categories: ["BlockChain"]
---

案例一

央行发行数字货币，发行的数字货币都有央行的私钥签名，央行公钥公开，人们可以使用公钥验证货币的真实性

这个方案是否可行？

这个数字货币是个文件，有央行的签名，无法被伪造，但可以被复制，实体货币只有一份，无法被复制，但数字货币可以被复制，支付多次

上面这种支付多次，就是 double spending attack（双花攻击）

使用了非对称加密，公私钥对，数字货币相当于文件，但文件就可以被复制



案例二

在一的基础上，每个数字货币都有唯一编号，而央行有一个数据库用于记录每个编号的货币的持有情况，支付则转移编号的所有权，收到数字货币的收款者可以通过数据库查询货币的持有者，判断付款者是否持有改数字货币



这个方案是否可行？

这个方案的正确性并且也可用，这是一种中心化的方案



是否可以有一种方案，做到去中心化，将货币的验证，由所有用户共同承担



去中心化货币需要解决两个问题

1. 数字货币的发行，由谁发行，什么时候发行，发行多少
2. 怎么验证交易的有效性，如何复制双花



比特币系统中由挖矿决定

如何防止双花

btc维护一个数据结构保存以前货币以前的交易记录，记录货币被谁用过，这个数据结构，就是区块链，

用户A获得铸币权（发售虚拟货币者）

A获得10个btc，a将货币转给B和C每人5个btc，这个交易需要由A签名证明交易被A所同意，同时还要说明化掉的比特币从哪里来的



A获得10个btc的交易称为铸币交易，凭空获取货币

每个交易包含输入 币的来源

输出  记录收款人公钥id



B将2个btc发给C，3个给D

币从 A-B中来

这时候C有7个ETc，2个来自于b-c，5个来自于a-c



c再发送给E7个



两种哈希指针，一种指向上个区块，另一种指向币的来源

用于说明币的来源=> 证明钱不是凭空捏造，有记录，同时为了防止双花



在这个情况下 b转给f5个比特币，由b签名，

从签名来看，合法，但从来源上回溯，发现b的5个币已经发送给了别人，那么这个交易没有币，即不合法

![image-20220428214028183](/Users/toka/Library/Application Support/typora-user-images/image-20220428214028183.png)

A转给b的交易，需要有A的签名， B的地址，收款地址从b的公钥取哈希后转化， b的公钥来源由b发布

A需要知道B的地址，B需要知道A的什么信息，b需要知道A的公钥



交易写入到区块链中需要一些条件

A需要有足够的币来源

B要知道A的公钥

	1. 证明币的来源
	1. 所有节点都需要知道A的公钥，用于验证A的签名

如何知道A的公钥 A加入到交易中

A的公钥，需要和A的币来源的输出的A的公钥对应



block header

	1. version 协议版本
	2. hash of previous block header 
	3. merkle tree root hash
	4. target 挖矿难度目标阈值 nBits
	5. nonce 难度随机数
	6. 

H（block header） 《= target



block body

* Transaction list



节点有分为全节点和轻节点

* full node (fully validating node)
* light node ()





Consensus in bitcoin

